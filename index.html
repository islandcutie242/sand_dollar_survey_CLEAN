<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sand Dollar Consumer Adoption Survey</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .likert-option {
            transition: all 0.2s;
        }
        .likert-option:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
            transform: translateY(-1px);
        }
        input[type="radio"]:checked + label {
            background-color: #10b981;
            color: white;
            border-color: #10b981;
        }
        .required-field:after {
            content: " *";
            color: #ef4444;
        }
    </style>
</head>
<body class="p-4 sm:p-8">
    <div class="max-w-3xl mx-auto bg-white p-6 sm:p-10 rounded-xl shadow-2xl border border-gray-100">
        
        <div id="exitScreen" class="hidden text-center py-16">
            <div class="bg-red-50 border border-red-200 rounded-xl p-8 max-w-2xl mx-auto">
                <div class="text-6xl mb-4">❌</div>
                <h2 class="text-2xl font-bold text-red-800 mb-4">Participation Declined</h2>
                <p class="text-red-700 mb-6">We respect your decision not to participate in the survey at this time.</p>
                <p class="text-red-600">Your privacy and consent are important to us. You may close this window now.</p>
            </div>
        </div>

        <div id="surveyContent">
            <header class="mb-8 border-b pb-4">
                <h1 class="text-3xl font-extrabold text-gray-900 mb-2">Sand Dollar Consumer Adoption Survey</h1>
                <p class="text-lg text-gray-500">Academic Research Project: BUSI-951-01 Introduction to Financial Technologies (FinTech) in Financial Services Fall 2025</p>
            </header>

            <div class="mb-10 p-6 bg-blue-50 border-l-4 border-blue-500 rounded-lg">
                <h2 class="text-xl font-semibold text-blue-800 mb-3">Introduction from the Researcher</h2>
                <p class="text-gray-700 leading-relaxed">Dear Participant,</p>
                <p class="text-gray-700 leading-relaxed mt-2">My name is **Renee Darling Neymour**, and I am a student in the **BUSI-951-01 Introduction to Financial Technologies (FinTech) in Financial Services Fall 2025** class.</p>
                <p class="text-gray-700 leading-relaxed mt-2">I am conducting this anonymous survey as part of an academic research project focused on digital currency adoption barriers in The Bahamas.</p>
                <p class="text-gray-700 leading-relaxed mt-2 font-medium">Your participation is incredibly valuable. Please be assured that all responses are strictly confidential and the results will **only** be used for the purpose of this research paper.</p>
                <p class="text-gray-700 leading-relaxed mt-2">Thank you for taking the time to complete this survey.</p>
            </div>

            <form id="sandDollarSurveyForm" class="space-y-10">
                <section id="section-consent">
                    <h3 class="text-xl font-bold text-gray-700 mb-4">Start of Survey: Consent</h3>
                    <p class="text-base text-gray-600 mb-4">0.0. Permission to Complete Survey</p>
                    <p class="text-sm italic text-gray-500 mb-6">This anonymous survey is for academic research only and is designed to assess public attitudes toward digital currency incentives in The Bahamas. Your responses will be kept confidential and used solely for this research paper. Do you agree to participate in this survey?</p>
                    <div class="flex flex-wrap gap-4">
                        <input type="radio" id="consent_yes" name="consent" value="Yes" class="hidden">
                        <label for="consent_yes" class="px-6 py-3 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors">Yes, I consent to participate</label>
                        <input type="radio" id="consent_no" name="consent" value="No" class="hidden">
                        <label for="consent_no" class="px-6 py-3 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors">No, I do not consent</label>
                    </div>
                    
                    <div id="continueButtonContainer" class="hidden mt-6 text-center">
                        <button type="button" id="continueButton" class="bg-green-600 text-white font-bold py-3 px-8 rounded-xl hover:bg-green-700 transition-colors shadow-lg shadow-green-500/50">
                            Continue to Survey Questions
                        </button>
                    </div>
                </section>

                <div id="surveyQuestions" class="hidden">
                    <section id="section-demographics">
                        <div class="mb-6">
                            <label class="block text-gray-800 font-semibold mb-3 required-field">A. Gender:</label>
                            <div class="flex flex-wrap gap-4">
                                <input type="radio" id="gender_f" name="gender" value="Female" class="hidden">
                                <label for="gender_f" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">Female</label>
                                <input type="radio" id="gender_m" name="gender" value="Male" class="hidden">
                                <label for="gender_m" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">Male</label>
                                <input type="radio" id="gender_pns" name="gender" value="Prefer not to say" class="hidden">
                                <label for="gender_pns" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">Prefer not to say</label>
                            </div>
                        </div>

                        <div class="mb-6">
                            <label class="block text-gray-800 font-semibold mb-3 required-field">B. Age Range:</label>
                            <div class="flex flex-wrap gap-4">
                                <input type="radio" id="age_18" name="age" value="18-24" class="hidden">
                                <label for="age_18" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">18-24</label>
                                <input type="radio" id="age_25" name="age" value="25-34" class="hidden">
                                <label for="age_25" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">25-34</label>
                                <input type="radio" id="age_35" name="age" value="35-49" class="hidden">
                                <label for="age_35" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">35-49</label>
                                <input type="radio" id="age_50" name="age" value="50-64" class="hidden">
                                <label for="age_50" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">50-64</label>
                                <input type="radio" id="age_65" name="age" value="65+" class="hidden">
                                <label for="age_65" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">65+</label>
                            </div>
                        </div>

                        <div class="mb-6">
                            <label class="block text-gray-800 font-semibold mb-3 required-field">C. Employment Status:</label>
                            <div class="flex flex-wrap gap-4">
                                <input type="radio" id="emp_ft" name="employment" value="Employed Full-Time" class="hidden">
                                <label for="emp_ft" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">Employed Full-Time</label>
                                <input type="radio" id="emp_pt" name="employment" value="Employed Part-Time" class="hidden">
                                <label for="emp_pt" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">Employed Part-Time</label>
                                <input type="radio" id="emp_se" name="employment" value="Self-Employed" class="hidden">
                                <label for="emp_se" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">Self-Employed</label>
                                <input type="radio" id="emp_st" name="employment" value="Student" class="hidden">
                                <label for="emp_st" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">Student</label>
                                <input type="radio" id="emp_re" name="employment" value="Retired" class="hidden">
                                <label for="emp_re" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">Retired</label>
                                <input type="radio" id="emp_un" name="employment" value="Unemployed" class="hidden">
                                <label for="emp_un" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">Unemployed</label>
                            </div>
                        </div>

                        <div class="mb-6">
                            <label class="block text-gray-800 font-semibold mb-3 required-field">D. Highest Level of Education Completed:</label>
                            <div class="flex flex-wrap gap-4">
                                <input type="radio" id="edu_hs" name="education" value="High School Diploma or equivalent" class="hidden">
                                <label for="edu_hs" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">High School Diploma or equivalent</label>
                                <input type="radio" id="edu_vtc" name="education" value="Vocational/Trade Certificate" class="hidden">
                                <label for="edu_vtc" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">Vocational/Trade Certificate</label>
                                <input type="radio" id="edu_ad" name="education" value="Associate's Degree" class="hidden">
                                <label for="edu_ad" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">Associate's Degree</label>
                                <input type="radio" id="edu_bd" name="education" value="Bachelor's Degree" class="hidden">
                                <label for="edu_bd" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">Bachelor's Degree</label>
                                <input type="radio" id="edu_gd" name="education" value="Graduate Degree or higher" class="hidden">
                                <label for="edu_gd" class="likert-option px-4 py-2 border border-gray-300 rounded-lg cursor-pointer bg-white">Graduate Degree or higher</label>
                            </div>
                        </div>
                    </section>

                    <div class="flex justify-between text-xs text-gray-600 font-medium px-4 py-2 bg-gray-100 rounded-lg shadow-inner mt-6 border-t pt-4">
                        <span class="text-red-600">1: Strongly Disagree</span>
                        <span>2: Disagree</span>
                        <span class="text-center">3: Neither Agree nor Disagree</span>
                        <span>4: Agree</span>
                        <span class="text-green-600">5: Strongly Agree</span>
                    </div>

                    <section id="section-barriers">
                        <div class="mb-8 mt-6">
                            <label class="block text-lg font-medium text-gray-800 mb-4 required-field">1. Barrier - Preference for Existing Methods:</label>
                            <p class="text-sm text-gray-600 mb-4">"I rarely use the Sand Dollar because my existing payment methods (cash, debit/credit card) are more convenient."</p>
                            <div class="flex justify-between space-x-2 sm:space-x-4">
                                <input type="radio" id="q1_1" name="q1_preference" value="1" class="hidden">
                                <label for="q1_1" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-red-50">1</label>
                                <input type="radio" id="q1_2" name="q1_preference" value="2" class="hidden">
                                <label for="q1_2" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-red-50">2</label>
                                <input type="radio" id="q1_3" name="q1_preference" value="3" class="hidden">
                                <label for="q1_3" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-gray-50">3</label>
                                <input type="radio" id="q1_4" name="q1_preference" value="4" class="hidden">
                                <label for="q1_4" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-green-50">4</label>
                                <input type="radio" id="q1_5" name="q1_preference" value="5" class="hidden">
                                <label for="q1_5" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-green-50">5</label>
                            </div>
                        </div>

                        <div class="mb-8">
                            <label class="block text-lg font-medium text-gray-800 mb-4 required-field">2. Barrier - Merchant Acceptance:</label>
                            <p class="text-sm text-gray-600 mb-4">"Most of the businesses and merchants where I shop regularly do not accept the Sand Dollar."</p>
                            <div class="flex justify-between space-x-2 sm:space-x-4">
                                <input type="radio" id="q2_1" name="q2_acceptance" value="1" class="hidden">
                                <label for="q2_1" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-red-50">1</label>
                                <input type="radio" id="q2_2" name="q2_acceptance" value="2" class="hidden">
                                <label for="q2_2" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-red-50">2</label>
                                <input type="radio" id="q2_3" name="q2_acceptance" value="3" class="hidden">
                                <label for="q2_3" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-gray-50">3</label>
                                <input type="radio" id="q2_4" name="q2_acceptance" value="4" class="hidden">
                                <label for="q2_4" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-green-50">4</label>
                                <input type="radio" id="q2_5" name="q2_acceptance" value="5" class="hidden">
                                <label for="q2_5" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-green-50">5</label>
                            </div>
                        </div>

                        <div class="mb-8">
                            <label class="block text-lg font-medium text-gray-800 mb-4 required-field">3. Barrier - Trust and Privacy:</label>
                            <p class="text-sm text-gray-600 mb-4">"I have concerns about the security or privacy of my money if I use the Sand Dollar."</p>
                            <div class="flex justify-between space-x-2 sm:space-x-4">
                                <input type="radio" id="q3_1" name="q3_trust" value="1" class="hidden">
                                <label for="q3_1" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-red-50">1</label>
                                <input type="radio" id="q3_2" name="q3_trust" value="2" class="hidden">
                                <label for="q3_2" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-red-50">2</label>
                                <input type="radio" id="q3_3" name="q3_trust" value="3" class="hidden">
                                <label for="q3_3" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-gray-50">3</label>
                                <input type="radio" id="q3_4" name="q3_trust" value="4" class="hidden">
                                <label for="q3_4" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-green-50">4</label>
                                <input type="radio" id="q3_5" name="q3_trust" value="5" class="hidden">
                                <label for="q3_5" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-green-50">5</label>
                            </div>
                        </div>
                    </section>

                    <section id="section-incentives">
                        <div class="border-t pt-6"></div> <div class="mb-8 mt-6">
                            <label class="block text-lg font-medium text-gray-800 mb-4 required-field">4. Incentive - General Receptivity:</label>
                            <p class="text-sm text-gray-600 mb-4">"I would be significantly more motivated to use the Sand Dollar if it offered me a direct financial benefit (e.g., discounts, rewards)."</p>
                            <div class="flex justify-between space-x-2 sm:space-x-4">
                                <input type="radio" id="q4_1" name="q4_general_incentive" value="1" class="hidden">
                                <label for="q4_1" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-red-50">1</label>
                                <input type="radio" id="q4_2" name="q4_general_incentive" value="2" class="hidden">
                                <label for="q4_2" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-red-50">2</label>
                                <input type="radio" id="q4_3" name="q4_general_incentive" value="3" class="hidden">
                                <label for="q4_3" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-gray-50">3</label>
                                <input type="radio" id="q4_4" name="q4_general_incentive" value="4" class="hidden">
                                <label for="q4_4" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-green-50">4</label>
                                <input type="radio" id="q4_5" name="q4_general_incentive" value="5" class="hidden">
                                <label for="q4_5" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-green-50">5</label>
                            </div>
                        </div>

                        <div class="mb-8">
                            <label class="block text-lg font-medium text-gray-800 mb-4 required-field">5. Incentive - Specific VAT Credit Impact:</label>
                            <p class="text-sm text-gray-600 mb-4">"I would choose to pay with the Sand Dollar for most purchases if the government offered a small VAT credit (e.g., 1%) on those transactions."</p>
                            <div class="flex justify-between space-x-2 sm:space-x-4">
                                <input type="radio" id="q5_1" name="q5_vat_credit" value="1" class="hidden">
                                <label for="q5_1" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-red-50">1</label>
                                <input type="radio" id="q5_2" name="q5_vat_credit" value="2" class="hidden">
                                <label for="q5_2" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-red-50">2</label>
                                <input type="radio" id="q5_3" name="q5_vat_credit" value="3" class="hidden">
                                <label for="q5_3" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-gray-50">3</label>
                                <input type="radio" id="q5_4" name="q5_vat_credit" value="4" class="hidden">
                                <label for="q5_4" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-green-50">4</label>
                                <input type="radio" id="q5_5" name="q5_vat_credit" value="5" class="hidden">
                                <label for="q5_5" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-green-50">5</label>
                            </div>
                        </div>

                        <div class="mb-8">
                            <label class="block text-lg font-medium text-gray-800 mb-4 required-field">6. Switching Behavior - Current Payment Methods:</label>
                            <p class="text-sm text-gray-600 mb-4">"If the Sand Dollar offered a VAT credit, I would switch from my current primary payment method (card or cash) to the Sand Dollar for daily expenses."</p>
                            <div class="flex justify-between space-x-2 sm:space-x-4">
                                <input type="radio" id="q6_1" name="q6_switching" value="1" class="hidden">
                                <label for="q6_1" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-red-50">1</label>
                                <input type="radio" id="q6_2" name="q6_switching" value="2" class="hidden">
                                <label for="q6_2" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-red-50">2</label>
                                <input type="radio" id="q6_3" name="q6_switching" value="3" class="hidden">
                                <label for="q6_3" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-gray-50">3</label>
                                <input type="radio" id="q6_4" name="q6_switching" value="4" class="hidden">
                                <label for="q6_4" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-green-50">4</label>
                                <input type="radio" id="q6_5" name="q6_switching" value="5" class="hidden">
                                <label for="q6_5" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-green-50">5</label>
                            </div>
                        </div>

                        <div class="mb-8">
                            <label class="block text-lg font-medium text-gray-800 mb-4 required-field">7. Attitude - Importance of Financial Benefit:</label>
                            <p class="text-sm text-gray-600 mb-4">"For the Sand Dollar to be widely adopted, it needs to offer a greater financial advantage than commercial bank products."</p>
                            <div class="flex justify-between space-x-2 sm:space-x-4">
                                <input type="radio" id="q7_1" name="q7_importance" value="1" class="hidden">
                                <label for="q7_1" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-red-50">1</label>
                                <input type="radio" id="q7_2" name="q7_importance" value="2" class="hidden">
                                <label for="q7_2" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-red-50">2</label>
                                <input type="radio" id="q7_3" name="q7_importance" value="3" class="hidden">
                                <label for="q7_3" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-gray-50">3</label>
                                <input type="radio" id="q7_4" name="q7_importance" value="4" class="hidden">
                                <label for="q7_4" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-green-50">4</label>
                                <input type="radio" id="q7_5" name="q7_importance" value="5" class="hidden">
                                <label for="q7_5" class="likert-option w-1/5 text-center px-2 py-3 border border-gray-300 rounded-xl cursor-pointer bg-white hover:bg-green-50">5</label>
                            </div>
                        </div>
                    </section>

                    <div id="validationMessage" class="hidden p-4 bg-red-50 border border-red-200 rounded-lg">
                        <p class="text-red-700 font-medium">Please complete all required questions before submitting the survey.</p>
                        <p class="text-red-600 text-sm mt-1">All questions marked with * are required.</p>
                    </div>

                    <div class="border-t pt-6">
                        <button type="submit" id="submitButton" class="w-full bg-blue-600 text-white font-bold py-3 rounded-xl hover:bg-blue-700 transition-colors shadow-lg shadow-blue-500/50">
                            Submit Survey
                        </button>
                    </div>
                </div>
                
                <div id="messageBox" class="p-4 mt-6 hidden" role="alert">
                    <p id="messageText" class="font-medium"></p>
                    <p class="text-sm mt-1" id="messageSubText"></p>
                </div>
            </form>
        </div>
        
        <div id="resultsContainer" class="hidden">
            </div>
    </div>

    <script type="module">
        // Import Firebase libraries for v11.6.1
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            signInAnonymously
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            serverTimestamp 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // YOUR FIREBASE CONFIGURATION (pulled from image_1c0c37.png)
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyCiWI0NNkGQRm7tYtntvSglkDv08FMuTqk", // Corrected API Key from screenshot
            authDomain: "sanddollarsurvey2025.firebaseapp.com",
            projectId: "sanddollarsurvey2025",
            storageBucket: "sanddollarsurvey2025.firebasestorage.app",
            messagingSenderId: "980365100199",
            appId: "1:980365100199:web:5929df6358a25057e78782",
            measurementId: "G-ECY2YFY394"
        };
        
        // The collection path where responses will be saved (from your old code)
        const APP_ID = FIREBASE_CONFIG.projectId; 
        const COLLECTION_PATH = `/artifacts/${APP_ID}/public/data/survey_responses`;

        // Initialize Firebase services
        const app = initializeApp(FIREBASE_CONFIG);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        let userId = null;

        // --- DOM Elements (Same as your old code) ---
        const surveyContainer = document.getElementById('sandDollarSurveyForm');
        const surveyContent = document.getElementById('surveyContent');
        const exitScreen = document.getElementById('exitScreen');
        const surveyQuestions = document.getElementById('surveyQuestions');
        const continueButtonContainer = document.getElementById('continueButtonContainer');
        const continueButton = document.getElementById('continueButton');
        const validationMessage = document.getElementById('validationMessage');
        const messageBox = document.getElementById('messageBox');
        const messageText = document.getElementById('messageText');
        const messageSubText = document.getElementById('messageSubText');
        const submitButton = document.getElementById('submitButton');
        const consentNo = document.getElementById('consent_no');
        const consentYes = document.getElementById('consent_yes');
        
        // 1. EXIT SCREEN FUNCTIONALITY
        function showExitScreen() {
            surveyContent.classList.add('hidden');
            exitScreen.classList.remove('hidden');
        }

        // 2. SHOW SURVEY QUESTIONS WHEN CONSENT IS GIVEN
        function showContinueButton() {
            continueButtonContainer.classList.remove('hidden');
        }

        function showSurveyQuestions() {
            surveyQuestions.classList.remove('hidden');
            continueButtonContainer.classList.add('hidden');
            surveyQuestions.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Listen for consent selections
        consentNo.addEventListener('change', function() {
            if (this.checked) {
                showExitScreen();
            }
        });

        consentYes.addEventListener('change', function() {
            if (this.checked) {
                showContinueButton();
            }
        });

        // Continue button click handler
        continueButton.addEventListener('click', showSurveyQuestions);

        // 3. FORM VALIDATION FUNCTION
        function validateForm() {
            // Check consent first
            if (!document.querySelector('input[name="consent"]:checked')) {
                return false;
            }

            // List of required question groups (names of radio buttons)
            const requiredFields = [
                'gender', 'age', 'employment', 'education', 
                'q1_preference', 'q2_acceptance', 'q3_trust', 
                'q4_general_incentive', 'q5_vat_credit', 'q6_switching', 'q7_importance'
            ];

            let isValid = true;
            for (const field of requiredFields) {
                if (!document.querySelector(`input[name="${field}"]:checked`)) {
                    isValid = false;
                    break;
                }
            }
            
            if (!isValid) {
                validationMessage.classList.remove('hidden');
            } else {
                validationMessage.classList.add('hidden');
            }
            
            return isValid;
        }

        // 4. SUBMIT FORM HANDLER
        surveyContainer.addEventListener('submit', async function(e) {
            e.preventDefault();

            if (!validateForm()) {
                return; // Stop if validation fails
            }

            submitButton.disabled = true;
            submitButton.textContent = 'Submitting...';

            try {
                // Collect form data
                const formData = new FormData(surveyContainer);
                const data = {
                    timestamp: serverTimestamp(),
                    userId: userId, // User ID from anonymous sign-in
                    ...Object.fromEntries(formData.entries())
                };

                // Remove consent data before saving (optional, but clean)
                delete data.consent;

                // Save data to Firestore
                await addDoc(collection(db, COLLECTION_PATH), data);

                // On success: hide form, show success message
                surveyQuestions.classList.add('hidden');
                document.getElementById('section-consent').classList.add('hidden');
                messageBox.classList.remove('hidden', 'bg-red-100', 'border-red-500');
                messageBox.classList.add('bg-green-100', 'border-green-500');
                messageText.classList.remove('text-red-700');
                messageText.classList.add('text-green-700');
                messageText.textContent = '✅ Survey Submitted Successfully!';
                messageSubText.textContent = 'Thank you for participating in the Sand Dollar Consumer Adoption Survey.';

            } catch (error) {
                console.error("Error writing document: ", error);
                // On failure: show error message
                messageBox.classList.remove('hidden', 'bg-green-100', 'border-green-500');
                messageBox.classList.add('bg-red-100', 'border-red-500');
                messageText.classList.remove('text-green-700');
                messageText.classList.add('text-red-700');
                messageText.textContent = '❌ Submission Failed. Please try again.';
                messageSubText.textContent = `Error: ${error.message}. Check your console and Firebase rules.`;

            } finally {
                submitButton.disabled = false;
                submitButton.textContent = 'Submit Survey';
            }
        });

        // 5. ANONYMOUS AUTHENTICATION ON PAGE LOAD
        signInAnonymously(auth)
            .then((userCredential) => {
                userId = userCredential.user.uid;
                console.log("Signed in anonymously. UID:", userId);
                // The survey questions are initially hidden and shown after consent is given.
            })
            .catch((error) => {
                const errorCode = error.code;
                const errorMessage = error.message;
                console.error("Anonymous sign-in failed:", errorCode, errorMessage);
                alert("The survey cannot load due to an authentication error. Check your Firebase settings.");
            });
    </script>
</body>
</html>
